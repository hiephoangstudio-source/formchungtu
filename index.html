<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªá Th·ªëng In Bi·ªÉu M·∫´u T·ªïng H·ª£p</title>
    
    <!-- Th∆∞ vi·ªán h·ªó tr·ª£ xu·∫•t PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Times+New+Roman:ital,wght@0,400;0,700;1,400;1,700&display=swap');
        
        * { box-sizing: border-box; }

        body { 
            font-family: 'Times New Roman', serif; 
            color: #000; 
            background-color: #525659; 
            margin: 0; padding: 0; 
        }

        /* --- C·∫§U H√åNH TRANG IN --- */
        @page { size: A4 portrait; margin: 0; }

        /* --- TOOLBAR --- */
        .actions-container { 
            position: sticky; top: 0; 
            display: flex; align-items: center; justify-content: center; gap: 15px;
            width: 100%; background-color: #343a40; padding: 10px; z-index: 2000; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            flex-wrap: wrap;
        }
        
        .control-group { display: flex; align-items: center; gap: 8px; background: #495057; padding: 5px 12px; border-radius: 4px; color: white; }
        .control-label { font-size: 14px; font-weight: bold; }
        .action-btn { background-color: #0d6efd; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; height: 38px; font-weight: bold; }
        .action-btn:hover { background-color: #0b5ed7; }
        .mode-select { padding: 0 10px; border-radius: 4px; border: 1px solid #ccc; height: 38px; cursor: pointer; outline: none; font-weight: 500; }

        .page-wrapper { display: flex; justify-content: center; padding: 30px; min-height: 100vh; }

        .a4-page {
            width: 210mm;
            min-height: 296mm; 
            background: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            position: relative;
            margin: auto;
            overflow: hidden; 
        }

        .form-container { display: none !important; width: 100%; height: 100%; }
        .form-container.active { display: block !important; }
        .hidden { display: none !important; }

        /* --- X·ª¨ L√ù CHIA 2 LI√äN --- */
        .voucher-section-half { 
            height: 48%; 
            display: flex; flex-direction: column; 
            padding: 0 2px; 
            overflow: hidden; 
        }

        /* Class ch·ªânh kho·∫£ng c√°ch ƒë·ªÉ tr√°nh d√≠nh ƒë∆∞·ªùng c·∫Øt (Y√äU C·∫¶U 3) */
        .voucher-section-half.top {
            padding-bottom: 10px; /* C√°ch ƒë∆∞·ªùng c·∫Øt b√™n d∆∞·ªõi m·ªôt ch√∫t */
        }
        .voucher-section-half.bottom {
            padding-top: 25px; /* ƒê·∫©y n·ªôi dung xu·ªëng xa ƒë∆∞·ªùng c·∫Øt h∆°n */
        }

        .middle-gap { 
            height: 4%; 
            display: flex; align-items: center; justify-content: center; width: 100%; 
        }
        .cut-line { width: 100%; border-top: 1px dashed #000; height: 1px; }

        .center { text-align: center; }
        .right { text-align: right; }
        .bold { font-weight: bold; }

        /* ==========================================================================
           FORM 1: GIAO NH·∫¨N (GI·ªÆ NGUY√äN)
           ========================================================================== */
        #form-handover { font-size: 10pt; line-height: 1.25; padding: 10mm 15mm; }
        #form-handover .header-section { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        #form-handover .header-left { flex: 1; }
        #form-handover .studio-name { font-weight: bold; font-size: 11pt; text-transform: uppercase; display: block; margin-bottom: 2px; }
        #form-handover .studio-info { display: block; font-size: 10pt; margin-bottom: 1px; }
        #form-handover .header-right { text-align: left; min-width: 140px; }
        #form-handover .voucher-num-line { font-size: 10pt; margin-bottom: 2px; }
        #form-handover .title-section { text-align: center; margin-bottom: 15px; }
        #form-handover .main-title { font-size: 18pt; font-weight: bold; text-transform: uppercase; margin: 0; }
        #form-handover .date-sub { font-style: italic; font-size: 10pt; margin-top: 5px; }
        #form-handover .info-section { margin-bottom: 15px; }
        #form-handover .form-row { display: flex; align-items: baseline; margin-bottom: 8px; } 
        #form-handover .label { white-space: nowrap; margin-right: 5px; font-size: 11pt; }
        #form-handover .value { flex: 1; border-bottom: 1px dotted #000; font-weight: bold; padding-left: 5px; font-size: 11pt; min-height: 18px; }
        #form-handover table.handover-table { width: 100%; border-collapse: collapse; font-size: 10pt; margin-bottom: 10px; }
        #form-handover table.handover-table th { border: 1px solid #000; padding: 5px 2px; background: #fff; font-weight: bold; height: 35px; vertical-align: middle; text-align: center;}
        #form-handover table.handover-table td { border: 1px solid #000; padding: 4px; height: 25px; vertical-align: middle; }
        #form-handover .signature-block-wrapper { margin-top: 5px; display: flex; flex-direction: column; justify-content: space-between; }
        #form-handover .sig-section { margin-bottom: 10px; }
        #form-handover .sig-header-row { display: flex; justify-content: space-between; margin-bottom: 2px; }
        #form-handover .sig-section-title { font-weight: bold; text-decoration: underline; font-size: 11pt;}
        #form-handover .sig-date-line { font-style: italic; font-size: 10pt; }
        #form-handover .sig-grid { display: flex; justify-content: space-between; text-align: center; }
        #form-handover .sig-col { width: 19%; } 
        #form-handover .sig-role { font-weight: bold; font-size: 10pt; margin-bottom: 2px; }
        #form-handover .sig-note { font-style: italic; font-size: 9pt; margin-bottom: 35px; } 

        /* ==========================================================================
           FORM 2: H√ìA ƒê∆†N THANH TO√ÅN (UPDATED SPACING & REMOVED LIEN INFO)
           ========================================================================== */
        #form-invoice { font-size: 9.5pt; line-height: 1.15; padding: 5mm 10mm; display: flex; flex-direction: column; justify-content: flex-start; }
        #form-invoice .header-section { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 2px; }
        #form-invoice .header-left { flex: 1; text-align: left; }
        #form-invoice .studio-name { font-weight: bold; font-size: 11pt; text-transform: uppercase; display: block; margin-bottom: 1px; }
        #form-invoice .studio-info { display: block; font-size: 9pt; margin-bottom: 0; }
        #form-invoice .header-right { text-align: left; min-width: 160px; }
        #form-invoice .voucher-num-line { font-size: 9.5pt; margin-bottom: 1px; }
        #form-invoice .title-section { text-align: center; margin-bottom: 8px; margin-top: -5px; }
        #form-invoice .main-title { font-size: 16pt; font-weight: bold; text-transform: uppercase; margin: 0; line-height: 1.2;}
        #form-invoice .date-sub { font-style: italic; font-size: 9pt; margin: 0; }
        #form-invoice .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 5px; }
        #form-invoice .form-row { display: flex; align-items: baseline; margin-bottom: 2px; }
        #form-invoice .label { white-space: nowrap; margin-right: 5px; font-size: 9.5pt; min-width: 60px; }
        #form-invoice .value { flex: 1; border-bottom: 1px dotted #000; font-weight: bold; padding-left: 3px; font-size: 9.5pt; min-height: 14px; }
        #form-invoice table.stock-table { width: 100%; border-collapse: collapse; font-size: 9.5pt; margin: 5px 0; }
        #form-invoice table.stock-table th { border: 1px solid #000; padding: 3px 2px; background: #eee; font-weight: bold; text-align: center;}
        #form-invoice table.stock-table td { border: 1px solid #000; padding: 2px 4px; height: 27px; vertical-align: middle; }
        #form-invoice .signatures { display: flex; justify-content: space-between; text-align: center; margin-top: 10px; }
        #form-invoice .sig-col { flex: 1; }
        #form-invoice .sig-title { font-weight: bold; font-size: 8.5pt; margin-bottom: 2px; text-transform: uppercase; }
        #form-invoice .sig-note { font-style: italic; font-size: 8pt; margin: 0 0 80px 0; } 
        #form-invoice .sig-name { font-weight: bold; font-size: 9.5pt; }

        /* ==========================================================================
           FORM 3: X√ÅC NH·∫¨N C√îNG VI·ªÜC (UPDATED: NO BORDER, SPACING, NO LIEN TEXT)
           ========================================================================== */
        #form-work { font-size: 10pt; line-height: 1.3; padding: 5mm 10mm; display: flex; flex-direction: column; justify-content: flex-start; }
        
        #form-work .header-section { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 5px; padding-bottom: 5px; border-bottom: 1px double #ccc; }
        #form-work .studio-name { font-weight: bold; font-size: 11pt; text-transform: uppercase; display: block; margin-bottom: 2px; color: #333; }
        #form-work .studio-info { display: block; font-size: 9.5pt; margin-bottom: 1px; color: #555; }
        #form-work .voucher-num-line { font-size: 9.5pt; margin-bottom: 2px; text-align: right; }
        
        #form-work .title-section { text-align: center; margin-bottom: 10px; margin-top: 5px; }
        #form-work .main-title { font-size: 16pt; font-weight: bold; text-transform: uppercase; margin: 0; line-height: 1.2; letter-spacing: 0.5px; }
        #form-work .date-sub { font-style: italic; font-size: 10pt; margin-top: 2px; }

        /* Y√äU C·∫¶U 2: B·ªé KHUNG BO ·ªû TH√îNG TIN KH√ÅCH H√ÄNG */
        #form-work .customer-box { 
            margin-bottom: 10px; 
            border: none; /* ƒê√£ b·ªè vi·ªÅn */
            padding: 0;   /* B·ªè padding ƒë·ªÉ s√°t l·ªÅ h∆°n */
            background: transparent; 
        }

        #form-work .info-row { display: flex; margin-bottom: 4px; align-items: baseline;}
        #form-work .info-row:last-child { margin-bottom: 0; }
        #form-work .info-label { font-weight: bold; font-size: 10pt; white-space: nowrap; margin-right: 8px; min-width: 85px; }
        #form-work .info-val { font-weight: normal; font-size: 10pt; border-bottom: 1px dotted #999; flex: 1; }

        #form-work .section-title { font-weight: bold; font-size: 10pt; text-transform: uppercase; margin: 8px 0 5px 0; border-left: 4px solid #333; padding-left: 8px; background: #eee; line-height: 1.5; }

        /* Service Grid */
        #form-work .service-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px 20px; margin-bottom: 8px; }
        #form-work .svc-item { display: flex; align-items: baseline; }
        #form-work .svc-label { font-weight: bold; font-size: 10pt; margin-right: 5px; color: #333; min-width: 70px; }
        #form-work .svc-val { font-size: 10pt; font-weight: normal; border-bottom: 1px dashed #ccc; flex: 1; }
        #form-work .svc-full { grid-column: 1 / -1; display: flex; align-items: baseline; }

        /* Ekip Table */
        #form-work table.ekip-table { width: 100%; border-collapse: collapse; font-size: 10pt; margin-top: 2px; }
        #form-work table.ekip-table th { border: 1px solid #000; padding: 4px; background: #f0f0f0; font-weight: bold; text-align: center; }
        #form-work table.ekip-table td { border: 1px solid #000; padding: 4px 8px; vertical-align: middle; }
        
        /* Signatures */
        #form-work .signatures { display: flex; justify-content: space-between; text-align: center; margin-top: 15px; }
        #form-work .sig-col { width: 32%; }
        #form-work .sig-title { font-weight: bold; font-size: 9.5pt; text-transform: uppercase; margin-bottom: 2px; }
        #form-work .sig-space { height: 50px; } 
        #form-work .sig-note { font-style: italic; font-size: 9pt; margin-top: -2px; color: #555; }
        #form-work .sig-name { font-weight: bold; font-size: 10pt; margin-top: 2px; }

        /* PRINT MODE */
        @media print {
            body, html { margin: 0; padding: 0; background: #fff; height: 100%; }
            .actions-container { display: none !important; }
            .page-wrapper { padding: 0; margin: 0; display: block; height: auto; }
            .a4-page { width: 100%; height: auto; box-shadow: none; margin: 0; overflow: visible; }
            .form-container { display: none !important; }
            .form-container.active { display: block !important; }
        }
    </style>
</head>
<body>

    <!-- TOOLBAR -->
    <div class="actions-container">
        <div class="control-group">
            <span class="control-label">üìë Ch·ªçn M·∫´u:</span>
            <select id="main-form-selector" class="mode-select" onchange="switchForm(this.value)">
                <option value="form-handover">1. Bi√™n B·∫£n Giao Nh·∫≠n</option>
                <option value="form-invoice">2. H√≥a ƒê∆°n B√°n H√†ng</option>
                <option value="form-work">3. X√°c Nh·∫≠n C√¥ng Vi·ªác</option>
            </select>
        </div>

        <div id="invoice-controls" class="control-group hidden">
            <span class="control-label">üñ®Ô∏è In H√≥a ƒê∆°n:</span>
            <select id="invoice-print-mode" class="mode-select" onchange="changeInvoiceMode(this.value)">
                <option value="both">In 2 Li√™n (A4)</option>
                <option value="lien1">Ch·ªâ Li√™n 1</option>
                <option value="lien2">Ch·ªâ Li√™n 2</option>
            </select>
        </div>

        <div id="work-controls" class="control-group hidden">
            <span class="control-label">üñ®Ô∏è In X√°c Nh·∫≠n CV:</span>
            <select id="work-print-mode" class="mode-select" onchange="changeWorkMode(this.value)">
                <option value="both">In 2 Li√™n (A4)</option>
                <option value="lien1">Ch·ªâ Li√™n 1</option>
                <option value="lien2">Ch·ªâ Li√™n 2</option>
            </select>
        </div>

        <button onclick="window.print()" class="action-btn">üñ®Ô∏è In Ngay</button>
        <button onclick="downloadPDF()" class="action-btn">üì• T·∫£i PDF</button>
    </div>

    <!-- MAIN PAGE -->
    <div class="page-wrapper">
        <div class="a4-page" id="print-area">
            
            <!-- FORM 1: GIAO NH·∫¨N -->
            <div id="form-handover" class="form-container active">
                <div class="header-section">
                    <div class="header-left">
                        <span class="studio-name" id="f1-ten-studio">2H STUDIO</span>
                        <span class="studio-info">ƒêC: <span id="f1-dc-studio"></span></span>
                        <span class="studio-info">Email: <span id="f1-email-studio"></span></span>
                        <span class="studio-info">Hotline: <span id="f1-hl-studio"></span></span>
                    </div>
                    <div class="header-right">
                        <div class="voucher-num-line">Quy·ªÉn s·ªë: ...........</div>
                        <div class="voucher-num-line">S·ªë: <span class="bold" id="f1-so-phieu">..........</span></div>
                    </div>
                </div>
                <div class="title-section">
                    <h1 class="main-title">B·∫¢N GIAO NH·∫¨N V·∫¨T T∆Ø, TRANG PH·ª§C</h1>
                    <div class="date-sub" id="f1-ngay-thang">Ng√†y ... th√°ng ... nƒÉm ...</div>
                </div>
                <div class="info-section">
                    <div class="form-row"><span class="label">H·ªç v√† t√™n ng∆∞·ªùi nh·∫≠n h√†ng:</span><span class="value"></span></div>
                    <div class="form-row"><span class="label">ƒê·ªãa ch·ªâ (B·ªô ph·∫≠n):</span><span class="value"></span></div>
                    <div class="form-row"><span class="label">L√Ω do xu·∫•t h√†ng:</span><span class="value"></span></div>
                    <div class="form-row">
                        <span class="label" style="width: 50%;">Xu·∫•t t·∫°i kho: <span class="value" style="border:none; border-bottom:1px dotted #000" id="f1-kho-nhap"></span></span>
                        <span class="label" style="width: 50%;">ƒê·ªãa ƒëi·ªÉm: <span class="value" style="border:none; border-bottom:1px dotted #000" id="f1-dia-diem"></span></span>
                    </div>
                </div>
                <table class="handover-table">
                    <thead>
                        <tr><th style="width: 35px;">STT</th><th>T√™n v·∫≠t t∆∞, d·ª•ng c·ª•, s·∫£n ph·∫©m</th><th style="width: 50px;">S·ªë l∆∞·ª£ng<br>xu·∫•t</th><th style="width: 70px;">ƒê∆°n gi√°</th><th style="width: 80px;">Th√†nh ti·ªÅn</th><th style="width: 50px;">S·ªë l∆∞·ª£ng<br>nh·∫≠n</th><th style="width: 80px;">Ghi ch√∫</th></tr>
                    </thead>
                    <tbody id="f1-table-body"></tbody>
                </table>
                <div class="signature-block-wrapper">
                    <div class="sig-section">
                        <div class="sig-header-row"><span class="sig-section-title">1. Xu·∫•t h√†ng:</span><span class="sig-date-line">Xu·∫•t ng√†y‚Ä¶‚Ä¶ th√°ng ‚Ä¶‚Ä¶ nƒÉm ‚Ä¶..</span></div>
                        <div class="sig-grid"><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi l·∫≠p phi·∫øu</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi giao h√†ng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi nh·∫≠n h√†ng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">K·∫ø to√°n tr∆∞·ªüng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">ƒê·∫°i di·ªán Studio</div><div class="sig-note">(K√Ω, ƒë√≥ng d·∫•u)</div></div></div>
                    </div>
                    <div class="sig-section">
                        <div class="sig-header-row"><span class="sig-section-title">2. Nh·∫≠p h√†ng:</span><span class="sig-date-line">Nh·∫≠p ng√†y‚Ä¶‚Ä¶ th√°ng ‚Ä¶‚Ä¶ nƒÉm ‚Ä¶..</span></div>
                        <div class="sig-grid"><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi l·∫≠p phi·∫øu</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi giao h√†ng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi nh·∫≠n h√†ng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">K·∫ø to√°n tr∆∞·ªüng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">ƒê·∫°i di·ªán Studio</div><div class="sig-note">(K√Ω, ƒë√≥ng d·∫•u)</div></div></div>
                    </div>
                    <div class="sig-section">
                        <div class="sig-header-row"><span class="sig-section-title">3. H√†ng m·∫•t h·ªèng:</span><span class="sig-date-line">K√Ω nh·∫≠n ng√†y‚Ä¶‚Ä¶ th√°ng ‚Ä¶‚Ä¶ nƒÉm ‚Ä¶..</span></div>
                        <div class="sig-grid"><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi l·∫≠p phi·∫øu</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi giao h√†ng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">Ng∆∞·ªùi nh·∫≠n h√†ng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">K·∫ø to√°n tr∆∞·ªüng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div><div class="sig-col"><div class="sig-role">ƒê·∫°i di·ªán Studio</div><div class="sig-note">(K√Ω, ƒë√≥ng d·∫•u)</div></div></div>
                    </div>
                </div>
            </div>

            <!-- FORM 2: H√ìA ƒê∆†N -->
            <div id="form-invoice" class="form-container"></div>

            <!-- FORM 3: X√ÅC NH·∫¨N CV -->
            <div id="form-work" class="form-container"></div>

        </div>
    </div>

    <script>
        const params = new URLSearchParams(window.location.search);
        let currentFormTitle = "";

        // DATA MOCK
        const dataHandover = {
            id_phieu: params.get('id') || "..........",
            ngay_lap: params.get('ngay') || new Date().toISOString().split('T')[0],
            studio_ten: params.get('ten_studio') || "2H STUDIO",
            studio_dc: params.get('dia_chi_studio') || "",
            studio_email: params.get('email_studio') || "",
            studio_hl: params.get('hotline_studio') || "",
        };

        const chiNhanhHD = (params.get('chi_nhanh') || "HC").toUpperCase();
        const dataInvoice = {
            meta: {
                so_phieu: chiNhanhHD === "SG" ? "SG..........." : "HC...........",
                ma_hd: params.get('ma_hd') || params.get('id') || "..........",
                ngay_lap: params.get('ngay') || new Date().toISOString().split('T')[0],
            },
            seller: {
                ten: params.get('ten_studio') || "2H STUDIO",
                email: params.get('email_studio') || "",
                sdt: params.get('hotline_studio') || params.get('sdt_studio') || "",
                dia_chi: params.get('dia_chi_studio') || params.get('diachi_studio') || ""
            },
            buyer: { 
                ten: params.get('khach') || "Kh√°ch l·∫ª", 
                sdt: params.get('sdt') || "",
                dia_chi: params.get('diachi') || ""
            }
        };

        const dataWork = {
            id_cv: params.get('id') || "CV-2026-001",
            ngay_lap: params.get('ngay_tao') || new Date().toISOString().split('T')[0],
            nguoi_tao: params.get('nguoi_tao') || "Admin",
            studio_ten: params.get('ten_studio') || "2H Studio - S√†i g√≤n",
            studio_dc: params.get('dia_chi_studio') || "85 H·ªì VƒÉn Hu√™",
            studio_email: params.get('email_studio') || "2hstudio.wedding@gmail.com",
            studio_hl: params.get('hotline_studio') || "037 893 2005",
            khach_ten: params.get('khach') || "Nguy·ªÖn VƒÉn A - L√™ Th·ªã B",
            khach_sdt: params.get('sdt') || "0909000xxx",
            khach_dc: params.get('diachi') || "Qu·∫≠n 1, TP.HCM",
            dich_vu: params.get('dv') || "Ch·ª•p Album Pre-Wedding",
            ngay_thuc_hien: params.get('ngay_lam') || "30/01/2026",
            dia_diem: params.get('diadiem') || "Phim tr∆∞·ªùng ABC",
            goi_chup: params.get('goi') || "G√≥i Premium",
            thoi_gian: params.get('time') || "08:00 - 17:00",
            ghi_chu: params.get('ghichu') || "Kh√°ch y√™u c·∫ßu ch·ª•p style H√†n Qu·ªëc nh·∫π nh√†ng.",
            ekip: [
                { role: "Photographer Ch√≠nh", name: params.get('nv') || "Nguy·ªÖn VƒÉn Ch·ª•p" },
                { role: "Makeup Artist", name: "Tr·∫ßn Th·ªã Ph·∫•n" },
                { role: "Ph·ª• m√°y / Lighting", name: "L√™ VƒÉn ƒê√®n" },
                { role: "Stylist", name: "" }
            ]
        };

        function renderHandover() {
            document.getElementById('f1-so-phieu').textContent = dataHandover.id_phieu;
            document.getElementById('f1-ten-studio').textContent = dataHandover.studio_ten;
            document.getElementById('f1-dc-studio').textContent = dataHandover.studio_dc;
            document.getElementById('f1-email-studio').textContent = dataHandover.studio_email;
            document.getElementById('f1-hl-studio').textContent = dataHandover.studio_hl;
            document.getElementById('f1-kho-nhap').textContent = dataHandover.studio_ten; 
            document.getElementById('f1-dia-diem').textContent = dataHandover.studio_dc;

            const d = new Date(dataHandover.ngay_lap);
            const dateStr = `Ng√†y ${d.getDate().toString().padStart(2,'0')} th√°ng ${(d.getMonth()+1).toString().padStart(2,'0')} nƒÉm ${d.getFullYear()}`;
            document.getElementById('f1-ngay-thang').textContent = dateStr;

            const tbody = document.getElementById('f1-table-body');
            let rowsHtml = '';
            for (let i = 0; i < 15; i++) {
                rowsHtml += `<tr><td class="center">${i+1}</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>`;
            }
            tbody.innerHTML = rowsHtml;
        }

        function createInvoiceHtml() {
            let d = new Date(dataInvoice.meta.ngay_lap);
            if(isNaN(d.getTime())) d = new Date();
            const dateStr = `Ng√†y ${d.getDate().toString().padStart(2,'0')} th√°ng ${(d.getMonth()+1).toString().padStart(2,'0')} nƒÉm ${d.getFullYear()}`;
            
            let rowsHtml = '';
            for (let i = 0; i < 5; i++) { 
                rowsHtml += `<tr><td class="center">${i+1}</td><td></td><td></td><td></td><td></td></tr>`;
            }

            // Y√äU C·∫¶U 1: B·ªé LI√äN INFO
            return `
                <div class="header-section">
                    <div class="header-left">
                        <span class="studio-name">${dataInvoice.seller.ten}</span>
                        <span class="studio-info">Email: ${dataInvoice.seller.email}</span>
                        <span class="studio-info">Hotline: ${dataInvoice.seller.sdt}</span>
                    </div>
                    <div class="header-right">
                        <div class="voucher-num-line">Quy·ªÉn s·ªë: ...........</div>
                        <div class="voucher-num-line">S·ªë: <span class="bold">${dataInvoice.meta.so_phieu}</span></div>
                        <div class="voucher-num-line">M√£ HD: <span class="bold">${dataInvoice.meta.ma_hd}</span></div>
                    </div>
                </div>
                <div class="title-section">
                    <h1 class="main-title">H√ìA ƒê∆†N B√ÅN H√ÄNG</h1>
                    <div class="date-sub">${dateStr}</div>
                </div>
                <div class="info-grid">
                    <div class="info-box">
                        <div class="form-row"><span class="label">Ng∆∞·ªùi b√°n:</span><span class="value">${dataInvoice.seller.ten}</span></div>
                        <div class="form-row"><span class="label">SƒêT:</span><span class="value">${dataInvoice.seller.sdt}</span></div>
                        <div class="form-row"><span class="label">ƒê·ªãa ch·ªâ:</span><span class="value">${dataInvoice.seller.dia_chi}</span></div>
                    </div>
                    <div class="info-box">
                        <div class="form-row"><span class="label">Ng∆∞·ªùi mua:</span><span class="value">${dataInvoice.buyer.ten}</span></div>
                        <div class="form-row"><span class="label">SƒêT:</span><span class="value">${dataInvoice.buyer.sdt}</span></div>
                        <div class="form-row"><span class="label">ƒê·ªãa ch·ªâ:</span><span class="value">${dataInvoice.buyer.dia_chi}</span></div>
                    </div>
                </div>
                <div style="flex-grow:1">
                    <table class="stock-table">
                        <thead><tr><th style="width:35px">STT</th><th>T√äN H√ÄNG - D·ªäCH V·ª§</th><th style="width:50px">SL</th><th style="width:100px">ƒê∆†N GI√Å</th><th style="width:110px">TH√ÄNH TI·ªÄN</th></tr></thead>
                        <tbody>${rowsHtml}</tbody>
                        <tfoot><tr><td colspan="4" class="right bold">T·ªîNG C·ªòNG</td><td class="right bold"></td></tr></tfoot>
                    </table>
                    <div class="form-row" style="margin-top: 5px;"><span class="label" style="font-style: italic; min-width: 150px;">Th√†nh ti·ªÅn (vi·∫øt b·∫±ng ch·ªØ):</span><span class="value" style="border:none; border-bottom:1px dotted #000; font-style:italic"></span></div>
                </div>
                <div class="signatures">
                    <div class="sig-col"><div class="sig-title">Ng∆∞·ªùi l·∫≠p phi·∫øu</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div>
                    <div class="sig-col"><div class="sig-title">Ng∆∞·ªùi mua h√†ng</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div>
                    <div class="sig-col"><div class="sig-title">Th·ªß qu·ªπ</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div>
                    <div class="sig-col"><div class="sig-title">K·∫ø to√°n</div><div class="sig-note">(K√Ω, h·ªç t√™n)</div></div>
                    <div class="sig-col"><div class="sig-title">ƒê·∫°i di·ªán ƒë∆°n v·ªã</div><div class="sig-note">(K√Ω, ƒë√≥ng d·∫•u)</div></div>
                </div>`;
        }

        function renderInvoice() {
            const container = document.getElementById('form-invoice');
            
            // Y√äU C·∫¶U 3: TH√äM CLASS .top CHO LI√äN 1
            const lien1Div = document.createElement('div'); 
            lien1Div.id = 'inv-lien-1'; 
            lien1Div.className = 'voucher-section-half top'; 
            lien1Div.innerHTML = createInvoiceHtml();
            
            const sepDiv = document.createElement('div'); 
            sepDiv.id = 'inv-separator'; 
            sepDiv.className = 'middle-gap';
            sepDiv.innerHTML = `<div class="cut-line"></div>`;

            // Y√äU C·∫¶U 3: TH√äM CLASS .bottom CHO LI√äN 2 (TƒÇNG PADDING TOP)
            const lien2Div = document.createElement('div'); 
            lien2Div.id = 'inv-lien-2'; 
            lien2Div.className = 'voucher-section-half bottom'; 
            lien2Div.innerHTML = createInvoiceHtml();

            container.innerHTML = '';
            container.appendChild(lien1Div);
            container.appendChild(sepDiv);
            container.appendChild(lien2Div);
        }

        function changeInvoiceMode(mode) {
            const l1 = document.getElementById('inv-lien-1');
            const l2 = document.getElementById('inv-lien-2');
            const sep = document.getElementById('inv-separator');
            if(!l1) return;
            l1.classList.remove('hidden'); l2.classList.remove('hidden'); sep.classList.remove('hidden');
            if (mode === 'lien1') { l2.classList.add('hidden'); sep.classList.add('hidden'); }
            else if (mode === 'lien2') { l1.classList.add('hidden'); sep.classList.add('hidden'); }
        }

        function createWorkHtml() {
            const d = new Date(dataWork.ngay_lap);
            const dateStr = `Ng√†y ${d.getDate().toString().padStart(2,'0')} th√°ng ${(d.getMonth()+1).toString().padStart(2,'0')} nƒÉm ${d.getFullYear()}`;
            
            let ekipRows = "";
            dataWork.ekip.forEach((member, index) => {
                ekipRows += `<tr><td class="center">${index + 1}</td><td>${member.role}</td><td>${member.name}</td></tr>`;
            });
            for(let i = dataWork.ekip.length; i < 4; i++) {
                ekipRows += `<tr><td class="center">${i+1}</td><td></td><td></td></tr>`;
            }

            // Y√äU C·∫¶U 1: B·ªé LI√äN INFO, Y√äU C·∫¶U 2: ƒê√É X·ª¨ L√ù CSS CUSTOMER-BOX
            return `
                <div class="header-section">
                    <div>
                        <span class="studio-name">${dataWork.studio_ten}</span>
                        <span class="studio-info">ƒêC: ${dataWork.studio_dc}</span>
                        <span class="studio-info">Hotline: ${dataWork.studio_hl}</span>
                    </div>
                    <div>
                        <div class="voucher-num-line">S·ªë: <span class="bold">${dataWork.id_cv}</span></div>
                    </div>
                </div>
                
                <div class="title-section">
                    <h1 class="main-title">BI√äN B·∫¢N X√ÅC NH·∫¨N C√îNG VI·ªÜC</h1>
                    <div class="date-sub">${dateStr}</div>
                </div>
                
                <div class="customer-box">
                    <div class="info-row">
                        <span class="info-label">Kh√°ch h√†ng:</span><span class="info-val bold">${dataWork.khach_ten}</span>
                        <span class="info-label" style="margin-left:15px; min-width:40px">SƒêT:</span><span class="info-val bold">${dataWork.khach_sdt}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">ƒê·ªãa ch·ªâ:</span><span class="info-val">${dataWork.khach_dc}</span>
                    </div>
                </div>

                <div class="section-title">I. TH√îNG TIN D·ªäCH V·ª§</div>
                <div class="service-grid">
                    <div class="svc-item"><span class="svc-label">H·∫°ng m·ª•c:</span><span class="svc-val bold">${dataWork.dich_vu}</span></div>
                    <div class="svc-item"><span class="svc-label">G√≥i ch·ª•p:</span><span class="svc-val">${dataWork.goi_chup}</span></div>
                    <div class="svc-item"><span class="svc-label">Ng√†y l√†m:</span><span class="svc-val bold">${dataWork.ngay_thuc_hien}</span></div>
                    <div class="svc-item"><span class="svc-label">Th·ªùi gian:</span><span class="svc-val">${dataWork.thoi_gian}</span></div>
                    <div class="svc-full"><span class="svc-label">ƒê·ªãa ƒëi·ªÉm:</span><span class="svc-val">${dataWork.dia_diem}</span></div>
                    <div class="svc-full"><span class="svc-label">Ghi ch√∫:</span><span class="svc-val" style="font-style:italic">${dataWork.ghi_chu}</span></div>
                </div>

                <div class="section-title">II. DANH S√ÅCH NH√ÇN VI√äN TH·ª∞C HI·ªÜN (EKIP)</div>
                <table class="ekip-table">
                    <thead><tr><th style="width:40px">STT</th><th style="width:150px">V·ªã tr√≠ / C√¥ng vi·ªác</th><th>T√™n nh√¢n vi√™n</th></tr></thead>
                    <tbody>${ekipRows}</tbody>
                </table>

                <div class="signatures">
                    <div class="sig-col"><div class="sig-title">Ng∆∞·ªùi l·∫≠p phi·∫øu</div><div class="sig-space"></div><div class="sig-name">${dataWork.nguoi_tao}</div></div>
                    <div class="sig-col"><div class="sig-title">Kh√°ch h√†ng</div><div class="sig-note">(K√Ω, x√°c nh·∫≠n)</div><div class="sig-space"></div></div>
                    <div class="sig-col"><div class="sig-title">ƒê·∫°i di·ªán Studio</div><div class="sig-note">(K√Ω, ƒë√≥ng d·∫•u)</div><div class="sig-space"></div></div>
                </div>
            `;
        }

        function renderWorkConf() {
            const container = document.getElementById('form-work');
            
            // Y√äU C·∫¶U 3: TH√äM CLASS .top v√† .bottom ƒê·ªÇ CH·ªàNH KHO·∫¢NG C√ÅCH
            const wLien1 = document.createElement('div'); 
            wLien1.id = 'work-lien-1'; 
            wLien1.className = 'voucher-section-half top';
            wLien1.innerHTML = createWorkHtml();

            const sepDiv = document.createElement('div'); 
            sepDiv.id = 'work-separator'; 
            sepDiv.className = 'middle-gap';
            sepDiv.innerHTML = `<div class="cut-line"></div>`;

            const wLien2 = document.createElement('div'); 
            wLien2.id = 'work-lien-2'; 
            wLien2.className = 'voucher-section-half bottom';
            wLien2.innerHTML = createWorkHtml();

            container.innerHTML = '';
            container.appendChild(wLien1);
            container.appendChild(sepDiv);
            container.appendChild(wLien2);
        }

        function changeWorkMode(mode) {
            const l1 = document.getElementById('work-lien-1');
            const l2 = document.getElementById('work-lien-2');
            const sep = document.getElementById('work-separator');
            if(!l1) return;
            l1.classList.remove('hidden'); l2.classList.remove('hidden'); sep.classList.remove('hidden');
            if (mode === 'lien1') { l2.classList.add('hidden'); sep.classList.add('hidden'); }
            else if (mode === 'lien2') { l1.classList.add('hidden'); sep.classList.add('hidden'); }
        }

        function switchForm(formId) {
            document.querySelectorAll('.form-container').forEach(el => el.classList.remove('active'));
            document.getElementById(formId).classList.add('active');
            document.getElementById('invoice-controls').classList.add('hidden');
            document.getElementById('work-controls').classList.add('hidden');

            if(formId === 'form-invoice') {
                document.getElementById('invoice-controls').classList.remove('hidden');
                currentFormTitle = "HD_" + dataInvoice.meta.ma_hd;
            } 
            else if(formId === 'form-work') {
                document.getElementById('work-controls').classList.remove('hidden');
                currentFormTitle = "CV_" + dataWork.id_cv;
            }
            else {
                currentFormTitle = "GIAO_NHAN_" + dataHandover.id_phieu;
            }
            document.title = currentFormTitle;
        }

        function downloadPDF() {
            const activeForm = document.querySelector('.form-container.active');
            if(!activeForm) return;

            let filename = currentFormTitle;
            let opt = { 
                margin: 0, 
                filename: filename + '.pdf', 
                image: { type: 'jpeg', quality: 0.98 }, 
                html2canvas: { scale: 2 }, 
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' } 
            };

            if(activeForm.id === 'form-invoice') {
                const mode = document.getElementById('invoice-print-mode').value;
                if(mode !== 'both') filename += '_' + mode;
            }
            if(activeForm.id === 'form-work') {
                const mode = document.getElementById('work-print-mode').value;
                if(mode !== 'both') filename += '_' + mode;
            }
            
            opt.filename = filename + '.pdf';
            html2pdf().from(activeForm).set(opt).save();
        }

        document.addEventListener('DOMContentLoaded', () => {
            renderHandover();
            renderInvoice();
            renderWorkConf();
            switchForm('form-handover');
        });
    </script>
</body>
</html>
